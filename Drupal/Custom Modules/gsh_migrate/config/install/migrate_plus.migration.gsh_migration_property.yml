id: gsh_migration_property
label: 'Migrate Property data from the csv file'
migration_group: gsh_migration
source:
  plugin: csv
  # Full path to the file.
  path: 'modules/custom/gsh_migrate/assets/csv/property.csv'
  header_row_count: 1
  keys:
    - nid
process:
  # Adding the mapping between the fields and the csv columns.
  nid: nid
  vid: vid
  title: title
  uid: author_uid
  status: status
  created: post_date
  changed: updated_date
  promote: promoted_to_front_page
  sticky: sticky
  field_spec_type:
    plugin: entity_lookup
    source: spec_type
    entity_type: taxonomy_term
    bundle_key: vid
    bundle: spec_type
    value_key: name
  field_display_name: display_name
  field_marketing_tagline: marketing_tagline
  field_featured_image: featured_image
  field_elevation:
    plugin: entity_lookup
    source: elevation
    entity_type: taxonomy_term
    bundle_key: vid
    bundle: elevations
    value_key: name
  field_floorplan:
    plugin: entity_lookup
    source: floorplan
    entity_type: taxonomy_term
    bundle_key: vid
    bundle: floorplans
    value_key: name
  field_community:
    plugin: entity_lookup
    source: community
    entity_type: taxonomy_term
    bundle_key: vid
    bundle: communities
    value_key: name
  field_mls_number: mls_number
  field_price: price
  field_marketing_flag:
    plugin: entity_lookup
    source: marketing_flag
    entity_type: taxonomy_term
    bundle_key: vid
    bundle: property_flags
    value_key: name
#  field_date_sold:
#    plugin: format_date
#    from_format: 'Y-m-d H:i:s'
#    to_format: 'Y-m-d'
#    source: date_sold
  field_incentive/value: Incentive
  field_incentive/format:
    plugin: default_value
    default_value: "full_html"
  field_incentive_short: Incentive(short)
  field_hers_index_score: hers_index_score
  field_address: address
  field_city: city
  field_state: state
  field_zip_code: zip_code
  field_latitude: latitude
  field_longitude: longitude
  body/value: body
  body/format:
    plugin: default_value
    default_value: "full_html"
  field_content_image: content_image
  field_square_feet: square_feet
  field_bedrooms: bedrooms
  field_full_baths: full_baths
  field_half_baths: half_baths
  field_floors: floors
  field_garages: garage(s)
  field_master:
    plugin: entity_lookup
    source: master
    entity_type: taxonomy_term
    bundle_key: vid
    bundle: master_options
    value_key: name
  field_downloadable_brochure:
    - plugin: property_pdf_import_process
      source: downloadable_brochure
  field_property_video: property_video
  field_marketing_images:
    - plugin: explode
      delimiter: '|'
      source: marketing_images
  field_schools:
    - plugin: explode
      delimiter: ','
      source: school(s)
    - plugin: entity_lookup
      entity_type: taxonomy_term
      bundle_key: vid
      bundle: schools
      value_key: name
  field_highlight_news/value: highlight_news
  field_highlight_news/format:
      plugin: default_value
      default_value: "full_html"
  field_hn_background_color: highlight_news_background_color
destination:
  plugin: 'entity:node'
  default_bundle: property_spec
migration_dependencies:
  required:
    - gsh_migration_users
    - gsh_migration_spec_type
    - gsh_migration_elevation
    - gsh_migration_floorplans
    - gsh_migration_communities
    - gsh_migration_property_flags
    - gsh_migration_master_option
    - gsh_migration_schools
dependencies: { }
